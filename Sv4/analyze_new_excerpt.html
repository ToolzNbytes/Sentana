<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Analyze New Excerpt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="structure_display_v4.css">
  <link rel="stylesheet" href="analyze_new_excerpt.css">
</head>

<body>
<header class="topbar">
  <div class="leftControls">
    <button class="topIconBtn" id="headerBackBtn" title="Back to explorer" aria-label="Back to explorer">
      <svg class="icon" aria-hidden="true"><use href="../icons/exit_left.svg#icon"></use></svg>
    </button>
  </div>

  <div class="titleWrap">
    <span class="titleMain">Analyze New Excerpt</span>
    <span class="titleSub">Guided wizard for structuring and tagging</span>
  </div>
</header>

<main class="workspaces wizardWrap">
  <section class="workspace wizard">
    <div class="pageSection wizardSection">
      <div class="wizardProgressBar" aria-label="Wizard progress">
        <div class="progressStep" data-step="2">
          <div class="progressTrack"><span class="progressFill"></span></div>
          <div class="progressLabel">Metadata</div>
        </div>
        <div class="progressStep" data-step="3">
          <div class="progressTrack"><span class="progressFill"></span></div>
          <div class="progressLabel">Text input</div>
        </div>
        <div class="progressStep" data-step="4">
          <div class="progressTrack"><span class="progressFill"></span></div>
          <div class="progressLabel">Sentence split</div>
        </div>
        <div class="progressStep" data-step="5">
          <div class="progressTrack"><span class="progressFill"></span></div>
          <div class="progressLabel">Structures</div>
        </div>
        <div class="progressStep isDisabled" data-step="6">
          <div class="progressTrack"><span class="progressFill"></span></div>
          <div class="progressLabel">Checks</div>
        </div>
        <div class="progressStep isDisabled" data-step="7">
          <div class="progressTrack"><span class="progressFill"></span></div>
          <div class="progressLabel">Store</div>
        </div>
      </div>

      <div class="wizardStatus" id="wizardStatus" aria-live="polite">Ready.</div>

      <section class="wizardPanel isActive" data-panel="0">
        <p class="panelLead">
          This wizard helps you transform a raw excerpt into a fully analyzed entry:
          structure notation, tags, and optional notes. We will go step by step to keep
          it clear and repeatable.
        </p>
        <div class="panelCard">
          <div class="panelCardTitle">What you will produce</div>
          <ul class="panelList">
            <li>Cleaned excerpt text with reliable paragraph boundaries.</li>
            <li>Per-sentence structural splits ready for tagging.</li>
            <li>Tags and notes consistent with the Sentana registry.</li>
          </ul>
        </div>
        <div class="panelHint">
          Tip: You can move back at any time without losing your current work.
        </div>
      </section>

      <section class="wizardPanel" data-panel="1">
        <div class="metaLayout">
          <div class="metaGrid" aria-label="Metadata fields">
            <label class="field">
              <span>Work * (Title)</span>
              <input id="fWork" type="text" autocomplete="off"
                     data-hint-title="Work (Title)"
                     data-hint-body="Title of the work. Required."/>
              <div class="fieldHint">Title of the work. Required.</div>
            </label>

            <label class="field">
              <span>Author *</span>
              <input id="fAuthor" type="text" autocomplete="off"
                     data-hint-title="Author"
                     data-hint-body="Writer's full name. Required."/>
              <div class="fieldHint">Writer's full name. Required.</div>
            </label>

            <label class="field">
              <span>Year(s) of writing</span>
              <input id="fYear" type="text" autocomplete="off"
                     data-hint-title="Year(s) of writing"
                     data-hint-body="Year string or range (e.g., 1948 or 1948-50). If unknown, use publishing year like -1950."/>
              <div class="fieldHint">Year string or range (e.g., 1948 or 1948-50). If unknown, use publishing year like -1950.</div>
            </label>

            <label class="field">
              <span>Choice - What part from where</span>
              <input id="fChoice" type="text" autocomplete="off"
                     data-hint-title="Choice"
                     data-hint-body="Where the excerpt comes from (chapter, scene, page). Start with #id if you need multiple excerpts."/>
              <div class="fieldHint">Where the excerpt comes from (chapter, scene, page). Start with #id if you need multiple excerpts.</div>
            </label>

            <label class="field">
              <span>Language (ISO)</span>
              <input id="fLanguage" type="text" autocomplete="off"
                     data-hint-title="Language (ISO)"
                     data-hint-body="Lower-case ISO code: en, fr. Use fr/es for French translation of Spanish original."/>
              <div class="fieldHint">Lower-case ISO code: en, fr. Use fr/es for French translation of Spanish original.</div>
            </label>

            <label class="field">
              <span>Tags</span>
              <input id="fTags" type="text" autocomplete="off"
                     data-hint-title="Tags"
                     data-hint-body="Optional. Suggested: Classic, Ref, ToReview, Valid, Error, Pop, amateur. Free values allowed."/>
              <div class="fieldHint">Optional. Suggested: Classic, Ref, ToReview, Valid, Error, Pop, amateur. Free values allowed.</div>
            </label>

            <label class="field fieldFull">
              <span>Entry comment</span>
              <textarea id="fComment" rows="2"
                        data-hint-title="Entry comment"
                        data-hint-body="Optional. Literary interest and maintenance note."></textarea>
              <div class="fieldHint">Optional. Literary interest and maintenance note.</div>
            </label>
          </div>

          <aside class="metaHint" aria-live="polite">
            <div class="metaHintTitle" id="metaHintTitle">Work (Title)</div>
            <div class="metaHintBody" id="metaHintBody">
              Title of the work. Required.
            </div>
          </aside>
        </div>
      </section>

      <section class="wizardPanel" data-panel="2">
        <div class="textStepHeader">
          <div class="textStepLabel" id="textStepLabel">Text prep: Paste the raw excerpt</div>
          <div class="textStepNote">Use the main navigation button to move through text preparation phases.</div>
        </div>

        <textarea class="textArea" id="rawExcerpt" spellcheck="false" placeholder="Paste the raw excerpt text here..."></textarea>

        <div class="textSteps">
          <div class="textStep isActive" data-step="0">
            <div class="panelHint">
              Paste the excerpt as-is. Do not worry about hard line breaks yet; we will fix them next.
            </div>
          </div>

          <div class="textStep" data-step="1">
            <div class="joinLinesRow">
              <button class="wizardActionBtn" id="joinLinesBtn" type="button">Join lines</button>
              <span class="joinLinesMsg" id="joinLinesMsg">Paste text to check line breaks.</span>
            </div>
            <div class="panelHint">
              If the source had hard-wrapped lines (like in PDFs), joining lines restores
              the original paragraph flow.
            </div>
          </div>

          <div class="textStep" data-step="2">
            <div class="panelHint">
              Paragraphs should match the original work. Please confirm boundaries manually.
              The preview below separates paragraphs and indents the first line to help you check.
            </div>

            <div class="paraTools">
              <input id="paraSearchInput" type="text" placeholder="Find a few words..." aria-label="Search for words in excerpt"/>
              <button class="wizardActionBtn" id="paraNextBtn" type="button">Next</button>
              <button class="wizardActionBtn ghost" id="paraInsertBtn" type="button">Parag</button>
              <span class="paraSearchMsg" id="paraSearchMsg">Search for a phrase to navigate the text.</span>
            </div>

            <div class="paraPreview" id="paraPreview" aria-label="Paragraph preview"></div>
          </div>
        </div>
      </section>

      <section class="wizardPanel" data-panel="3">
        <div class="panelTitleRow">
          <div class="panelTitleText">Sentence split</div>
        </div>

        <div class="splitLayout">
          <div class="splitCol">
            <div class="splitLabel">Editable split text</div>
            <div class="splitHint splitHintWarn">Keep the leading space at the start of each paragraph line. It is the paragraph marker.</div>
            <textarea class="splitArea" id="sentenceSplitInput" spellcheck="false"></textarea>
          </div>
          <div class="splitCol splitPreviewCol">
            <div class="splitLabel">Formatted preview</div>
            <div class="splitHint splitHintInfo">Auto-split then review carefully. You can correct this later without losing work.</div>
            <div class="splitPreview" id="sentenceSplitPreview" aria-label="Sentence split preview"></div>
          </div>
        </div>
      </section>

      <section class="wizardPanel" data-panel="4">
        <div class="panelTitleRow panelTitleRowSplit">
          <div class="panelTitleBlock">
            <div class="panelTitleText">Structures</div>
            <div class="panelTitleMeta">
              <span id="structureCounter">Sentence 0 of 0</span>
              <span class="structureNavStatus" id="structureNavStatus">Sentence navigation</span>
            </div>
          </div>
          <div class="structureNav">
            <button class="wizardActionBtn structureNavBtn" id="prevSentenceBtn" type="button" aria-label="Previous sentence">↑</button>
            <button class="wizardActionBtn structureNavBtn" id="nextSentenceBtn" type="button" aria-label="Next sentence">↓</button>
          </div>
        </div>

        <div class="sentenceContext">
          <div class="sentenceContextItem isPrev" id="prevSentenceDisplay" hidden>
            <div class="sentenceContextText"></div>
            <button class="wizardActionBtn" id="fusePrevBtn" type="button">Fuse</button>
          </div>
          <div class="sentenceContextMain" id="currentSentenceDisplay"></div>
          <div class="sentenceContextItem isNext" id="nextSentenceDisplay" hidden>
            <div class="sentenceContextText"></div>
            <button class="wizardActionBtn" id="fuseNextBtn" type="button">Fuse</button>
          </div>
          <div class="sentenceContextActions">
            <button class="wizardActionBtn ghost" id="togglePrevContextBtn" type="button">Show previous</button>
            <button class="wizardActionBtn ghost" id="toggleNextContextBtn" type="button">Show following</button>
          </div>
        </div>

        <div class="structureWorkspace">
          <div class="structureSentenceTools">
            <div class="structureSentenceRow">
              <span class="structureCommentLabel">Sentence comment</span>
              <label class="structureToggle">
                <input id="sentenceDialogueToggle" type="checkbox"/>
                Dialogue (sentence root)
              </label>
            </div>
            <textarea id="sentenceComment" rows="1"></textarea>
          </div>

          <div class="structureTable" id="structureTable" role="table" aria-label="Structure workspace"></div>
        </div>

        <div class="structurePending" id="structurePendingStatus">Pending definitions.</div>
      </section>
    </div>

    <div class="wizardNav">
      <button class="wizardNavBtn" id="backBtn" type="button">Back</button>
      <button class="wizardNavBtn primary" id="nextBtn" type="button">Start</button>
    </div>
  </section>
</main>

<script src="sse_common.js"></script>
<script src="tag_registry.js"></script>
<script src="analyze_new_excerpt.js"></script>
</body>
</html>
