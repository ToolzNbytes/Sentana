:root{
  --bg:#17110c;
  --panel:#21160f;
  --paper:#e7d7b6;
  --ink:#efe6d5;
  --inkDim:rgba(239,230,213,.75);
  --muted:rgba(239,230,213,.65);
  --green:#5a7a5c;
  --border:rgba(231,215,182,.25);
  --error:#7a1f1b;
  --errorInk:#ffb8b2;
  --radius:14px;
  --radiusSm:10px;
  --serif:ui-serif, Georgia, "Times New Roman", serif;
  --sans:system-ui, -apple-system, Segoe UI, Roboto, Arial;
  --mono:ui-monospace, Menlo, Consolas, monospace;
  --hlBg:rgba(231,215,182,.22);
  --hlBd:rgba(231,215,182,.35);
  --hlBtn:rgba(138, 118, 82, 0.2); /* for hover */
  --hlCursorBd:#52ff5b;
  --hlChildBg:#d8c6ad;
  --listJoinBg:#15270e;
  --deconstructBg:#1c2318;
}

html{
  scrollbar-gutter: stable;
}

*{box-sizing:border-box}
html,body{height:auto}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:var(--sans);
}

/* ===== Top bar ===== */
.topbar{
  height:64px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: linear-gradient(180deg,#261a12,#21160f);
  /*position:sticky;
  top:0;*/
  z-index:10;
}

.titleWrap{
  display:flex;
  align-items:baseline;   /* keeps the small text nicely aligned */
  justify-content:center;
  text-align:center;
  line-height:1.2;

  /* prevents overlap with header left/right controls */
  padding: 0 140px;

  /* allow the main title to stay centered even if sub is hidden */
  gap: 8px;
}

.titleMain{
  font-family: var(--serif);
  font-size: 24px;
  color: var(--paper);
  white-space: nowrap;
}

.titleSub{
  font-family: var(--sans);
  font-size: 16px;
  color: rgba(239,230,213,.7);
  white-space: nowrap;
}

/* hide post-title part on narrow windows */
@media (max-width: 1020px){
  .titleWrap{ padding: 0 86px; }
  .titleSub{ display:none; }
}


/* Left controls */
.leftControls{
  position:absolute;
  left:14px;
  display:flex;
  align-items:center;
  gap:10px;
}

/* Right controls (settings + local data) */
.rightControls{
  position:absolute;
  right:14px;
  display:flex;
  align-items:center;
  gap:10px;
}

/* ===== Topbar icon buttons (SVG <use>) ===== */
.topIconBtn{
  width: 40px;
  height: 40px;
  box-sizing: border-box; /* include padding */
  padding: 8px;
  /* in html if needed preserveAspectRatio="xMidYMid meet" */
  border: none;
  border-radius: 8px;
  background: transparent;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
  user-select: none;

  color: var(--paper);
}

/* Force the svg to fill the button box */
.topIconBtn > svg.icon{
  width: 100%;
  height: 100%;
  display: block;
}
/* Slightly shrink the local data icon to reduce visual weight */
#localDataBtn > svg.icon{
  transform: scale(0.8, 0.9);
  transform-origin: 50% 50%;
}
/* hover when active */
.topIconBtn:not(:disabled):hover{
  background: var(--hlBtn);
}

.topIconBtn:disabled{
  opacity: 0.45;
  cursor: default;
}

/* ===== Layout ===== */
.workspaces{
  display:flex;
  gap:10px;
  padding:10px;
  align-items:stretch;
/*  height:calc(100% - 64px);
  overflow:auto;*/
}
.workspaceWrap{
  flex: 1 1 0;
  min-width: 520px;
}
.workspaceWrap.hidden {
  display: none;
}
.workspaceWrap {
  transition: transform 220ms ease, opacity 220ms ease;
}
.workspaceWrap.collapsingOut {
  transform: translateX(-24px);
  opacity: 0;
}

.workspace{
  flex:1;
  display:flex;
  flex-direction:column;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:visible;
  max-width:100%;
  transition: transform 220ms ease, opacity 220ms ease;
}

.copyR{
  flex:0 0 auto;
  display:flex;
  flex-direction:column;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  min-height:100%;
}
.infoR{
  position:relative;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
  text-align:center;
}
.infoR .line1{
  font-family:var(--serif);
  color:var(--paper);
  font-size:15px;
}
.infoR .line2{
  margin-top:4px;
  font-size:12.5px;
  color:rgba(239,230,213,.7);
}
.infoR .xDel{
  position:absolute;
  left:10px;
  top:10px;
  width:26px;
  height:26px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--paper);
  cursor:pointer;
  line-height:24px;
}
.mainR{
  padding:14px;
  overflow:auto;
  display:block;
}
.mainR .svgWrap{
  margin-bottom:15px;
}
.mainR .svgWrap:last-child{margin-bottom:0}

/* =====Main control or display area ===== */
.pageSection,
#excerptSelector{
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.row-1{
  display:flex;
  gap:12px;
}
.row-1 > *{flex:1}

.work-details{
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:var(--radiusSm);
  position: relative;
}

/* ===== Remote corpus filter panel (inside work-details) ===== */
.filterPanel{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.filterTitle{
  font-family: var(--serif);
  color: var(--paper);
  font-size: 14px;
  line-height: 1.2;
}
.filterSelect{
  width:100%;
  background:#17110c;
  color: var(--ink);
  border:none;
  border-radius: var(--radiusSm);
  padding:6px;
  resize: vertical;
  min-height: 160px;
}
.filterSelect:disabled{
  opacity: 0.65;
}
/* highlight the filter button when panel is open */
.iconBtn.isActive{
  background: var(--hlBtn);
}

.work{font-family:var(--serif);font-size:16px;color:var(--paper)}
.author{font-size:13px;color:var(--muted)}
.choice{font-size:13px;color:var(--green)}

.work-list{
  resize:vertical;
  min-height:96px;
  background:#17110c;
  color:var(--ink);
  border:none;
  border-radius:var(--radiusSm);
  padding:6px;
}

/*-----*/
/* Corpus switch + dual lists */
.listBlock{
  display:flex;
  gap:0;                /* gap 0 for special fx */
  align-items:stretch;
}

.corpusSwitch{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.corpusSwitch .iconBtn{
  width:38px;
  height:38px;
  border-radius:10px;
  margin-right:8px; /* compensate gap 0 */
  justify-content:flex-start;
  padding-left:8px;
  padding-right:8px;
}

.corpusSwitch .iconBtn.listSelectBtn:disabled{
  margin-right:0;
  width:46px;                 /* 38 + 8*/
  background:var(--listJoinBg);
  border-right:none;
  border-radius:10px 0 0 10px;
  opacity:1;
}


.listBlock .work-list{
  flex:1;
  min-height:140px;
  border-radius:0;
}


.listBlock .work-list:not(.hidden){
  background:var(--listJoinBg);
}

#corpusFilterBtn.hasFilter{
  border-style: dashed;
  border-width: 3px; /* 3x thicker than the default 1px border */
  border-color: rgba(231,215,182,.55);
}

.iconBtn{
  width:44px;
  height:44px;
  border-radius:12px;
  border:1px solid rgba(231,215,182,.18);
  background:transparent;
  color: var(--paper);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  user-select:none;
  /* no text inherit  */
  font-size:0;
  line-height:0;
}
.iconBtn:not(:disabled):hover{
  background: var(--hlBtn);
}
.iconBtn:disabled{
  opacity:.35;
  cursor:default;
}

.iconBtn.ghost{
  border-style:dashed;
  pointer-events:none;
}


#explorerArea{
  position: sticky;
  top: 0;
  z-index: 50;
  background: var(--panel);
  /* keep it visually aligned with the panels */
  padding: 14px;
  /* add space between row-2 and sentenceArea */
  display: flex;
  flex-direction: column;
  gap: 10px;
  /* optional: subtle separation from content beneath */
  border-bottom: 1px solid var(--border);
}

.row-2{
  display:flex;
  gap:8px;
}
.comment{
  flex:1;
  resize:vertical;
  min-height:56px;
  padding:8px 10px;
  font-size:12.5px;
  border:1px solid var(--border);
  border-radius:var(--radiusSm);
  color:var(--muted);
  background:transparent;
  white-space:pre-wrap;
}
.comment.error{
  background:rgba(122,31,27,.2);
  color:var(--errorInk);
  border-color:rgba(122,31,27,.6);
}
#excerptSourceBtn{
  width:36px;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--paper);
  font-size:20px;
  cursor:pointer;
}

#excerptSourceBtn:not(:disabled):hover{
  background: var(--hlBtn);
}

.sentence{
  resize:vertical;
  min-height:72px;
  padding:5px 10px 3px 10px;
  font-family:var(--serif);
  font-size:16px;
  line-height: 1.5;
  border:1px solid var(--border);
  border-radius:var(--radiusSm);
  background:#17110c;
  color:var(--ink);
  overflow:auto;
}
.sentence .hl{
  /*background:var(--hlBg);*/
  background: var(--ink);
  border-top:2px solid transparent;
  border-bottom:2px solid transparent;
  border-radius:6px;
  color: #17110c;
}
.sentence .hlCursor{
  border-top:2px solid var(--hlCursorBd);
  border-bottom:2px solid var(--hlCursorBd);
  border-radius:6px;
  color: #17110c;
}
.sentence .hlChild{
  background: var(--hlChildBg);
  border-top:2px solid transparent;
  border-bottom:2px solid transparent;
  border-radius:6px;
  color: #17110c;
}

/* ===== Result / SVG stack ===== */
.result-panel{
  flex:1;
  padding:14px;
  overflow:auto;
  display:block; /* wrappers manage spacing */
  background:var(--panel);
  border-bottom-left-radius: var(--radius);
  border-bottom-right-radius: var(--radius);
}
.svgWrap{
  margin-bottom:15px;
}
.svgWrap.groupWithNext{
  margin-bottom:3px;
}
.svgWrap:last-child{margin-bottom:0}
.result-panel svg{
  width:100%;
  display:block;
}

#deconstructPanel{
  display: none;
}
.deconstruct-panel{
  padding: 12px 14px 14px;
  background: var(--panel);
  border-top: 1px solid var(--border);
  border-bottom-left-radius: var(--radius);
  border-bottom-right-radius: var(--radius);
}
.deconstruct-header{
  display: flex;
  align-items: baseline;
  gap: 10px;
  margin-bottom: 6px;
}
.deconstruct-controls{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}
.deconstruct-controls .hoverBtn{
  background: none;
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--paper);
  padding: 6px 10px;
  cursor: pointer;
}
.deconstruct-status{
  font-size: 12.5px;
  color: var(--errorInk);
}
.deconstruct-title{
  font-family: var(--serif);
  color: var(--paper);
  margin-bottom: 6px;
}
.deconstruct-body{
  color: var(--ink);
  font-size: 14px;
}
.deconstruct-mode .result-panel{
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}
.deconstruct-mode #explorerArea{
  background: var(--deconstructBg);
}
.deconstruct-mode .result-panel{
  background: var(--deconstructBg);
}
.deconstruct-mode .deconstruct-panel{
  background: var(--deconstructBg);
}
.deconstruct-mode #deconstructPanel{
  display: block;
}
.deconstruct-mode .sentenceMenuItem[data-action="deconstruct"]{
  display: none;
}

/* ===== Sentence context menu ===== */
.sentenceMenu{
  position:absolute;
  z-index:120;
  width: 160px;
  background: linear-gradient(180deg, #2b1c12, #1d120c);
  border: 1px solid rgba(231,215,182,.28);
  border-radius: 12px;
  box-shadow: 0 10px 26px rgba(0,0,0,.45);
  color: var(--ink);
  padding: 6px 0;
}
.sentenceMenuTitle{
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px 6px 12px;
  font-family: var(--serif);
  color: var(--paper);
  border-bottom: 1px solid rgba(231,215,182,.18);
}
.sentenceMenuClose{
  background: transparent;
  border: none;
  color: var(--paper);
  cursor: pointer;
  font-family: var(--serif);
  font-size: 18px;
  line-height: 1;
  padding: 0 4px;
  align-self: stretch;
}
.sentenceMenuClose:hover,
.sentenceMenuClose:focus-visible{
  color: var(--ink);
  outline: none;
}
.sentenceMenuItem{
  width: 100%;
  background: transparent;
  border: none;
  color: var(--ink);
  text-align: left;
  padding: 8px 12px;
  font-size: 14px;
  font-family: var(--serif);
  cursor: pointer;
  white-space: normal;
}
.sentenceMenuItem:hover,
.sentenceMenuItem:focus-visible{
  background: rgba(231,215,182,.18);
  color: var(--paper);
  outline: none;
}
.sentenceMenuItem.isDisabled{
  opacity: 0.45;
  cursor: default;
}
.sentenceMenuItem.isDisabled:hover,
.sentenceMenuItem.isDisabled:focus-visible{
  background: transparent;
  color: var(--ink);
}

/* ===== Modal base ===== */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:flex-start;
  justify-content:center;
  padding:15px;
  z-index:100;
}
.modal {
  background: #1a120d;
  border: 1px solid var(--border);
  border-radius: var(--radius);

  /* width + allow user resizing */
  width: min(900px, 90vw);
  min-width: 320px;
  resize: horizontal;

  /* height behavior: grow, then clamp to viewport with 15px margins */
  max-height: calc(100vh - 30px);
  overflow: auto;          /* scrollbar appears only when needed */

  display: flex;
  flex-direction: column;

  /* avoid weird flex shrink in some modal wrappers */
  flex-shrink: 0;
}

.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  gap:10px;
}
.modalHeaderLeft{
  display: flex;
  align-items: center;
  gap: 8px;
}
.modal-header button{
  background:none;
  border:1px solid var(--border);
  border-radius:8px;
  color:var(--paper);
  padding:6px 10px;
  cursor:pointer;
}
.modal-content{
  padding:14px;
  overflow:auto;
  white-space:pre-wrap;
}
.modal-content.mono{
  font-family:var(--mono);
  font-size:13px;
}
.modal-content.serif{
  font-family:var(--serif);
  font-size:16px;
  line-height:1.5;
}
.modal-content.serif p {
  margin: 0 0 0.8em 0;
  text-indent: 1.6em;
}

/* ===== Parameter panel modal ===== */
.param-modal{
  width:460px;
  max-width:92%;
  max-height:80%;
}
.param-body{
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.param-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  font-size:13px;
  color:var(--ink);
}
.param-row input{
  width:160px;
  background:#17110c;
  color:var(--ink);
  border:1px solid var(--border);
  border-radius:8px;
  padding:6px 8px;
  font-family:var(--mono);
  font-size:13px;
}
.param-hint{
  font-size:12px;
  color:rgba(239,230,213,.55);
  line-height:1.35;
}
.param-actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  padding:10px 14px 14px;
}
.param-actions button{
  background:none;
  border:1px solid var(--border);
  border-radius:10px;
  color:var(--paper);
  padding:7px 12px;
  cursor:pointer;
}
.loading{
  padding: 14px;
  opacity: 0.75;
  font-style: italic;
}

.iconBtn svg,
#excerptSourceBtn svg{
  width: 22px;
  height: 22px;
  display: block;
  pointer-events: none;
}
.svgError {
  padding: 12px;
  font-style: italic;
  color: #fb3333;
  background: rgba(0,0,0,0.04);
  border-radius: 6px;
}
.svgSpacer{
  pointer-events: all;
}


/* Utility */
.hidden{display:none !important;}


/* ===== Local corpus manager ===== */
.localManagerWrap{
  width: 100%;
}
.localManager{
  max-width: 980px;
  margin: 0 auto;
}

.localSectionTitle{
  font-family: var(--serif);
  color: var(--paper);
  font-size: 14px;
  opacity: 0.95;
  margin-top: 2px;
}

.localEntryList{
  margin-top: 6px;
  border: 1px solid var(--border);
  border-radius: var(--radiusSm);
  background: #17110c;
  overflow: auto;
  max-height: 220px;
}

.entryRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 10px;
  background: rgba(231,215,182,.08);
  border-bottom: 1px solid rgba(231,215,182,.14);
  cursor:pointer;
}
.entryRow:last-child{ border-bottom: none; }

.entryRow.active{
  background: #17110c;
}
.entryRow.active .entryLabel{
  color: #f7f0e3;
}

.entryRowEmpty{
  cursor: default;
  color: rgba(239,230,213,.6);
  font-style: italic;
}

.entryLabel{
  flex:1;
  font-size: 13px;
  color: var(--inkDim);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.entryDelete{
  width: 28px;
  height: 28px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--paper);
  cursor: pointer;
  line-height: 26px;
  font-size: 18px;
}
.entryDelete:hover{
  background: var(--hlBtn);
}

.localMetaRow{
  margin-top: 6px;
  display:flex;
  gap:12px;
  align-items:stretch;
}

.localMetaGrid{
  flex: 1 1 auto;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px 12px;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radiusSm);
}

.field{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size: 12.5px;
  color: rgba(239,230,213,.8);
}
.fieldFull{ grid-column: 1 / -1; }

.localMetaGrid input,
.localMetaGrid textarea{
  background:#17110c;
  color:var(--ink);
  border:1px solid rgba(231,215,182,.22);
  border-radius: 10px;
  padding:7px 9px;
  font-family: var(--mono);
  font-size: 13px;
}

.localMetaGrid textarea{
  resize: vertical;
  min-height: 54px;
}

.localControlBox{
  width: 220px;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radiusSm);
}

.localControlButtons{
  display:flex;
  gap:10px;
}

.statusMsg{
  flex:1;
  border: 1px solid rgba(231,215,182,.22);
  border-radius: 10px;
  padding: 8px 10px;
  background: transparent;
  font-family: var(--mono);
  font-size: 13px;
  white-space: pre-wrap;
  color: rgba(239,230,213,.75);
  min-height: 70px;
}
.statusMsg.valid{
  color: rgba(199,233,192,.95);
}
.statusMsg.error{
  color: var(--errorInk);
  background: rgba(122,31,27,.2);
  border-color: rgba(122,31,27,.6);
}

.analysisInput{
  margin-top: 6px;
  width: 100%;
  min-height: 420px;
  resize: vertical;
  border: 1px solid var(--border);
  border-radius: var(--radiusSm);
  background: #17110c;
  color: var(--ink);
  font-family: var(--mono);
  font-size: 13px;
  line-height: 1.35;
  padding: 10px 12px;
  white-space: pre;
  overflow: auto;
}

.hoverBtn:not(:disabled):hover{
  background: var(--hlBtn);
}
